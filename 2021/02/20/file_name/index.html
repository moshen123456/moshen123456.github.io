<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>今日校园信息收集自动提交 | MoLuRen</title><meta name="keywords" content="打卡"><meta name="author" content="陌路人"><meta name="copyright" content="陌路人"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="描述">
<meta property="og:type" content="article">
<meta property="og:title" content="今日校园信息收集自动提交">
<meta property="og:url" content="http://example.com/2021/02/20/file_name/index.html">
<meta property="og:site_name" content="MoLuRen">
<meta property="og:description" content="描述">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/21/fwW5sN9B8J1UdPZ.jpg">
<meta property="article:published_time" content="2021-02-20T08:01:59.294Z">
<meta property="article:modified_time" content="2021-02-24T10:57:04.000Z">
<meta property="article:author" content="陌路人">
<meta property="article:tag" content="打卡">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/21/fwW5sN9B8J1UdPZ.jpg"><link rel="shortcut icon" href="/img/fa.png"><link rel="canonical" href="http://example.com/2021/02/20/file_name/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4420dd1d660088274ff1276f0a2d89b8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 陌路人","link":"链接: ","source":"来源: MoLuRen","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2021-02-24 18:57:04'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><script src="/live2d-widget/autoload.js"></script><link rel="stylesheet" href="/css/icont.css"><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly/"><i class="fa-fw fa fa-heart"></i><span> butterfly主题</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2021/02/21/fwW5sN9B8J1UdPZ.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">MoLuRen</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly/"><i class="fa-fw fa fa-heart"></i><span> butterfly主题</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">今日校园信息收集自动提交<a class="post-edit-link" href="null_posts/file_name.md" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-02-20T08:01:59.294Z" title="发表于 2021-02-20 16:01:59">2021-02-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-02-24T10:57:04.000Z" title="更新于 2021-02-24 18:57:04">2021-02-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%89%93%E5%8D%A1/">打卡</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>21分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><hr>
<blockquote>
<p>前言：今日校园自动打卡是<a target="_blank" rel="noopener" href="https://github.com/ZimoLoveShuang/auto-submit/" title="子墨">子墨</a>大佬弄的，此方法只是用来方便同学，当然其他学校<br>也是可以用的。</p>
</blockquote>
<h1 id="一-首先"><a href="#一-首先" class="headerlink" title="一,首先"></a>一,首先</h1><h3 id="1-下方链接是看你的学校云端能不能使用"><a href="#1-下方链接是看你的学校云端能不能使用" class="headerlink" title="1.下方链接是看你的学校云端能不能使用"></a>1.下方链接是看你的学校云端能不能使用</h3><p><a target="_blank" rel="noopener" href="http://www.zimo.wiki:8080/wisedu-unified-login-api-v1.0/swagger-ui.html#/api-controller/loginUsingGET">http://www.zimo.wiki:8080/wisedu-unified-login-api-v1.0/swagger-ui.html#/api-controller/loginUsingGET</a></p>
<h3 id="注：如果不能请去子墨的博客解决"><a href="#注：如果不能请去子墨的博客解决" class="headerlink" title="注：如果不能请去子墨的博客解决"></a>注：如果不能请去子墨的博客解决</h3><p>需要三个东西你的学号和密码和你学校的教务系统网站</p>
<h3 id="2-教务网站在这个地方查找自己学校的教务网站"><a href="#2-教务网站在这个地方查找自己学校的教务网站" class="headerlink" title="2.教务网站在这个地方查找自己学校的教务网站:"></a>2.教务网站在这个地方查找自己学校的教务网站:</h3><p><a target="_blank" rel="noopener" href="https://static.campushoy.com/apicache/tenantListSort">https://static.campushoy.com/apicache/tenantListSort</a></p>
<h1 id="二，代码"><a href="#二，代码" class="headerlink" title="二，代码"></a>二，代码</h1><p>今日校园自动提交所需：</p>
<h2 id="1-index-py"><a href="#1-index-py" class="headerlink" title="1.index.py:"></a>1.index.py:</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import yaml</span><br><span class="line">import oss2</span><br><span class="line">from urllib.parse import urlparse</span><br><span class="line">from datetime import datetime, timedelta, timezone</span><br><span class="line">from urllib3.exceptions import InsecureRequestWarning</span><br><span class="line">import smtplib</span><br><span class="line">from email.mime.text import MIMEText</span><br><span class="line">from email.utils import formataddr</span><br><span class="line"></span><br><span class="line">#debug模式</span><br><span class="line">debug &#x3D; False</span><br><span class="line">if debug:</span><br><span class="line">    requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#读取yml配置</span><br><span class="line">def getYmlConfig(yaml_file&#x3D;&#39;config.yml&#39;):</span><br><span class="line">    file &#x3D; open(yaml_file, &#39;r&#39;, encoding&#x3D;&quot;utf-8&quot;)</span><br><span class="line">    file_data &#x3D; file.read()</span><br><span class="line">    file.close()</span><br><span class="line">    config &#x3D; yaml.load(file_data, Loader&#x3D;yaml.FullLoader)</span><br><span class="line">    return dict(config)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#全局配置</span><br><span class="line">config &#x3D; getYmlConfig(yaml_file&#x3D;&#39;config.yml&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#获取今日校园api</span><br><span class="line">def getCpdailyApis(user):</span><br><span class="line">    apis &#x3D; &#123;&#125;</span><br><span class="line">    user &#x3D; user[&#39;user&#39;]</span><br><span class="line">    schools &#x3D; requests.get(</span><br><span class="line">        url&#x3D;&#39;https:&#x2F;&#x2F;mobile.campushoy.com&#x2F;v6&#x2F;config&#x2F;guest&#x2F;tenant&#x2F;list&#39;, verify&#x3D;not debug).json()[&#39;data&#39;]</span><br><span class="line">    flag &#x3D; True</span><br><span class="line">    for one in schools:</span><br><span class="line">        if one[&#39;name&#39;] &#x3D;&#x3D; user[&#39;school&#39;]:</span><br><span class="line">            if one[&#39;joinType&#39;] &#x3D;&#x3D; &#39;NONE&#39;:</span><br><span class="line">                log(user[&#39;school&#39;] + &#39; 未加入今日校园&#39;)</span><br><span class="line">                exit(-1)</span><br><span class="line">            flag &#x3D; False</span><br><span class="line">            params &#x3D; &#123;</span><br><span class="line">                &#39;ids&#39;: one[&#39;id&#39;]</span><br><span class="line">            &#125;</span><br><span class="line">            res &#x3D; requests.get(url&#x3D;&#39;https:&#x2F;&#x2F;mobile.campushoy.com&#x2F;v6&#x2F;config&#x2F;guest&#x2F;tenant&#x2F;info&#39;, params&#x3D;params,</span><br><span class="line">                               verify&#x3D;not debug)</span><br><span class="line">            data &#x3D; res.json()[&#39;data&#39;][0]</span><br><span class="line">            joinType &#x3D; data[&#39;joinType&#39;]</span><br><span class="line">            idsUrl &#x3D; data[&#39;idsUrl&#39;]</span><br><span class="line">            ampUrl &#x3D; data[&#39;ampUrl&#39;]</span><br><span class="line">            if &#39;campusphere&#39; in ampUrl or &#39;cpdaily&#39; in ampUrl:</span><br><span class="line">                parse &#x3D; urlparse(ampUrl)</span><br><span class="line">                host &#x3D; parse.netloc</span><br><span class="line">                res &#x3D; requests.get(parse.scheme + &#39;:&#x2F;&#x2F;&#39; + host)</span><br><span class="line">                parse &#x3D; urlparse(res.url)</span><br><span class="line">                apis[</span><br><span class="line">                    &#39;login-url&#39;] &#x3D; idsUrl + &#39;&#x2F;login?service&#x3D;&#39; + parse.scheme + r&quot;%3A%2F%2F&quot; + host + r&#39;%2Fportal%2Flogin&#39;</span><br><span class="line">                apis[&#39;host&#39;] &#x3D; host</span><br><span class="line"></span><br><span class="line">            ampUrl2 &#x3D; data[&#39;ampUrl2&#39;]</span><br><span class="line">            if &#39;campusphere&#39; in ampUrl2 or &#39;cpdaily&#39; in ampUrl2:</span><br><span class="line">                parse &#x3D; urlparse(ampUrl2)</span><br><span class="line">                host &#x3D; parse.netloc</span><br><span class="line">                res &#x3D; requests.get(parse.scheme + &#39;:&#x2F;&#x2F;&#39; + host)</span><br><span class="line">                parse &#x3D; urlparse(res.url)</span><br><span class="line">                apis[</span><br><span class="line">                    &#39;login-url&#39;] &#x3D; idsUrl + &#39;&#x2F;login?service&#x3D;&#39; + parse.scheme + r&quot;%3A%2F%2F&quot; + host + r&#39;%2Fportal%2Flogin&#39;</span><br><span class="line">                apis[&#39;host&#39;] &#x3D; host</span><br><span class="line">            break</span><br><span class="line">    if flag:</span><br><span class="line">        log(user[&#39;school&#39;] + &#39; 未找到该院校信息，请检查是否是学校全称错误&#39;)</span><br><span class="line">        exit(-1)</span><br><span class="line">    log(apis)</span><br><span class="line">    return apis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#获取当前utc时间，并格式化为北京时间</span><br><span class="line">def getTimeStr():</span><br><span class="line">    utc_dt &#x3D; datetime.utcnow().replace(tzinfo&#x3D;timezone.utc)</span><br><span class="line">    bj_dt &#x3D; utc_dt.astimezone(timezone(timedelta(hours&#x3D;8)))</span><br><span class="line">    return bj_dt.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#输出调试信息，并及时刷新缓冲区</span><br><span class="line">def log(content):</span><br><span class="line">    print(getTimeStr() + &#39; &#39; + str(content))</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#登陆并返回session</span><br><span class="line">def getSession(user, loginUrl):</span><br><span class="line">    user &#x3D; user[&#39;user&#39;]</span><br><span class="line">    params &#x3D; &#123;</span><br><span class="line">        &#39;login_url&#39;: loginUrl,</span><br><span class="line">        # 保证学工号和密码正确下面两项就不需要配置</span><br><span class="line">        &#39;needcaptcha_url&#39;: &#39;&#39;,</span><br><span class="line">        &#39;captcha_url&#39;: &#39;&#39;,</span><br><span class="line">        &#39;username&#39;: user[&#39;username&#39;],</span><br><span class="line">        &#39;password&#39;: user[&#39;password&#39;]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cookies &#x3D; &#123;&#125;</span><br><span class="line">    # 借助上一个项目开放出来的登陆API，模拟登陆</span><br><span class="line">    res &#x3D; requests.post(config[&#39;login&#39;][&#39;api&#39;], params, verify&#x3D;not debug)</span><br><span class="line">    cookieStr &#x3D; str(res.json()[&#39;cookies&#39;])</span><br><span class="line">    log(cookieStr)</span><br><span class="line">    if cookieStr &#x3D;&#x3D; &#39;None&#39;:</span><br><span class="line">        log(res.json())</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">    # 解析cookie</span><br><span class="line">    for line in cookieStr.split(&#39;;&#39;):</span><br><span class="line">        name, value &#x3D; line.strip().split(&#39;&#x3D;&#39;, 1)</span><br><span class="line">        cookies[name] &#x3D; value</span><br><span class="line">    session &#x3D; requests.session()</span><br><span class="line">    session.cookies &#x3D; requests.utils.cookiejar_from_dict(cookies)</span><br><span class="line">    return session</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查询表单</span><br><span class="line">def queryForm(session, apis):</span><br><span class="line">    host &#x3D; apis[&#39;host&#39;]</span><br><span class="line">    headers &#x3D; &#123;</span><br><span class="line">        &#39;Accept&#39;: &#39;application&#x2F;json, text&#x2F;plain, *&#x2F;*&#39;,</span><br><span class="line">        &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Linux; Android 4.4.4; OPPO R11 Plus Build&#x2F;KTU84P) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Version&#x2F;4.0 Chrome&#x2F;33.0.0.0 Safari&#x2F;537.36 yiban&#x2F;8.1.11 cpdaily&#x2F;8.1.11 wisedu&#x2F;8.1.11&#39;,</span><br><span class="line">        &#39;content-type&#39;: &#39;application&#x2F;json&#39;,</span><br><span class="line">        &#39;Accept-Encoding&#39;: &#39;gzip,deflate&#39;,</span><br><span class="line">        &#39;Accept-Language&#39;: &#39;zh-CN,en-US;q&#x3D;0.8&#39;,</span><br><span class="line">        &#39;Content-Type&#39;: &#39;application&#x2F;json;charset&#x3D;UTF-8&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    queryCollectWidUrl &#x3D; &#39;https:&#x2F;&#x2F;&#123;host&#125;&#x2F;wec-counselor-collector-apps&#x2F;stu&#x2F;collector&#x2F;queryCollectorProcessingList&#39;.format(</span><br><span class="line">        host&#x3D;host)</span><br><span class="line">    params &#x3D; &#123;</span><br><span class="line">        &#39;pageSize&#39;: 6,</span><br><span class="line">        &#39;pageNumber&#39;: 1</span><br><span class="line">    &#125;</span><br><span class="line">    res &#x3D; session.post(queryCollectWidUrl, headers&#x3D;headers,</span><br><span class="line">                       data&#x3D;json.dumps(params), verify&#x3D;not debug)</span><br><span class="line">    if len(res.json()[&#39;datas&#39;][&#39;rows&#39;]) &lt; 1:</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">    collectWid &#x3D; res.json()[&#39;datas&#39;][&#39;rows&#39;][0][&#39;wid&#39;]</span><br><span class="line">    formWid &#x3D; res.json()[&#39;datas&#39;][&#39;rows&#39;][0][&#39;formWid&#39;]</span><br><span class="line"></span><br><span class="line">    detailCollector &#x3D; &#39;https:&#x2F;&#x2F;&#123;host&#125;&#x2F;wec-counselor-collector-apps&#x2F;stu&#x2F;collector&#x2F;detailCollector&#39;.format(</span><br><span class="line">        host&#x3D;host)</span><br><span class="line">    res &#x3D; session.post(url&#x3D;detailCollector, headers&#x3D;headers,</span><br><span class="line">                       data&#x3D;json.dumps(&#123;&quot;collectorWid&quot;: collectWid&#125;), verify&#x3D;not debug)</span><br><span class="line">    schoolTaskWid &#x3D; res.json()[&#39;datas&#39;][&#39;collector&#39;][&#39;schoolTaskWid&#39;]</span><br><span class="line"></span><br><span class="line">    getFormFields &#x3D; &#39;https:&#x2F;&#x2F;&#123;host&#125;&#x2F;wec-counselor-collector-apps&#x2F;stu&#x2F;collector&#x2F;getFormFields&#39;.format(</span><br><span class="line">        host&#x3D;host)</span><br><span class="line">    res &#x3D; session.post(url&#x3D;getFormFields, headers&#x3D;headers, data&#x3D;json.dumps(</span><br><span class="line">        &#123;&quot;pageSize&quot;: 100, &quot;pageNumber&quot;: 1, &quot;formWid&quot;: formWid, &quot;collectorWid&quot;: collectWid&#125;), verify&#x3D;not debug)</span><br><span class="line"></span><br><span class="line">    form &#x3D; res.json()[&#39;datas&#39;][&#39;rows&#39;]</span><br><span class="line">    return &#123;&#39;collectWid&#39;: collectWid, &#39;formWid&#39;: formWid, &#39;schoolTaskWid&#39;: schoolTaskWid, &#39;form&#39;: form&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#填写form</span><br><span class="line">def fillForm(session, form, host):</span><br><span class="line">    sort &#x3D; 1</span><br><span class="line">    for formItem in form[:]:</span><br><span class="line">        # 只处理必填项</span><br><span class="line">        if formItem[&#39;isRequired&#39;] &#x3D;&#x3D; 1:</span><br><span class="line">            default &#x3D; config[&#39;cpdaily&#39;][&#39;defaults&#39;][sort - 1][&#39;default&#39;]</span><br><span class="line">            if formItem[&#39;title&#39;] !&#x3D; default[&#39;title&#39;]:</span><br><span class="line">                log(&#39;第%d个默认配置不正确，请检查&#39; % sort)</span><br><span class="line">                exit(-1)</span><br><span class="line">            # 文本直接赋值</span><br><span class="line">            if formItem[&#39;fieldType&#39;] &#x3D;&#x3D; 1 or formItem[&#39;fieldType&#39;] &#x3D;&#x3D; 5:</span><br><span class="line">                formItem[&#39;value&#39;] &#x3D; default[&#39;value&#39;]</span><br><span class="line">            # 单选框需要删掉多余的选项</span><br><span class="line">            if formItem[&#39;fieldType&#39;] &#x3D;&#x3D; 2:</span><br><span class="line">                # 填充默认值</span><br><span class="line">                formItem[&#39;value&#39;] &#x3D; default[&#39;value&#39;]</span><br><span class="line">                fieldItems &#x3D; formItem[&#39;fieldItems&#39;]</span><br><span class="line">                for i in range(0, len(fieldItems))[::-1]:</span><br><span class="line">                    if fieldItems[i][&#39;content&#39;] !&#x3D; default[&#39;value&#39;]:</span><br><span class="line">                        del fieldItems[i]</span><br><span class="line">            # 多选需要分割默认选项值，并且删掉无用的其他选项</span><br><span class="line">            if formItem[&#39;fieldType&#39;] &#x3D;&#x3D; 3:</span><br><span class="line">                fieldItems &#x3D; formItem[&#39;fieldItems&#39;]</span><br><span class="line">                defaultValues &#x3D; default[&#39;value&#39;].split(&#39;,&#39;)</span><br><span class="line">                for i in range(0, len(fieldItems))[::-1]:</span><br><span class="line">                    flag &#x3D; True</span><br><span class="line">                    for j in range(0, len(defaultValues))[::-1]:</span><br><span class="line">                        if fieldItems[i][&#39;content&#39;] &#x3D;&#x3D; defaultValues[j]:</span><br><span class="line">                            # 填充默认值</span><br><span class="line">                            formItem[&#39;value&#39;] +&#x3D; defaultValues[j] + &#39; &#39;</span><br><span class="line">                            flag &#x3D; False</span><br><span class="line">                    if flag:</span><br><span class="line">                        del fieldItems[i]</span><br><span class="line">            # 图片需要上传到阿里云oss</span><br><span class="line">            if formItem[&#39;fieldType&#39;] &#x3D;&#x3D; 4:</span><br><span class="line">                fileName &#x3D; uploadPicture(session, default[&#39;value&#39;], host)</span><br><span class="line">                formItem[&#39;value&#39;] &#x3D; getPictureUrl(session, fileName, host)</span><br><span class="line">            log(&#39;必填问题%d：&#39; % sort + formItem[&#39;title&#39;])</span><br><span class="line">            log(&#39;答案%d：&#39; % sort + formItem[&#39;value&#39;])</span><br><span class="line">            sort +&#x3D; 1</span><br><span class="line">        else:</span><br><span class="line">            form.remove(formItem)</span><br><span class="line">    # print(form)</span><br><span class="line">    return form</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#上传图片到阿里云oss</span><br><span class="line">def uploadPicture(session, image, host):</span><br><span class="line">    url &#x3D; &#39;https:&#x2F;&#x2F;&#123;host&#125;&#x2F;wec-counselor-collector-apps&#x2F;stu&#x2F;collector&#x2F;getStsAccess&#39;.format(</span><br><span class="line">        host&#x3D;host)</span><br><span class="line">    res &#x3D; session.post(url&#x3D;url, headers&#x3D;&#123;</span><br><span class="line">                       &#39;content-type&#39;: &#39;application&#x2F;json&#39;&#125;, data&#x3D;json.dumps(&#123;&#125;), verify&#x3D;not debug)</span><br><span class="line">    datas &#x3D; res.json().get(&#39;datas&#39;)</span><br><span class="line">    fileName &#x3D; datas.get(&#39;fileName&#39;)</span><br><span class="line">    accessKeyId &#x3D; datas.get(&#39;accessKeyId&#39;)</span><br><span class="line">    accessSecret &#x3D; datas.get(&#39;accessKeySecret&#39;)</span><br><span class="line">    securityToken &#x3D; datas.get(&#39;securityToken&#39;)</span><br><span class="line">    endPoint &#x3D; datas.get(&#39;endPoint&#39;)</span><br><span class="line">    bucket &#x3D; datas.get(&#39;bucket&#39;)</span><br><span class="line">    bucket &#x3D; oss2.Bucket(oss2.Auth(access_key_id&#x3D;accessKeyId,</span><br><span class="line">                                   access_key_secret&#x3D;accessSecret), endPoint, bucket)</span><br><span class="line">    with open(image, &quot;rb&quot;) as f:</span><br><span class="line">        data &#x3D; f.read()</span><br><span class="line">    bucket.put_object(key&#x3D;fileName, headers&#x3D;&#123;</span><br><span class="line">                      &#39;x-oss-security-token&#39;: securityToken&#125;, data&#x3D;data)</span><br><span class="line">    res &#x3D; bucket.sign_url(&#39;PUT&#39;, fileName, 60)</span><br><span class="line">    # log(res)</span><br><span class="line">    return fileName</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#获取图片上传位置</span><br><span class="line">def getPictureUrl(session, fileName, host):</span><br><span class="line">    url &#x3D; &#39;https:&#x2F;&#x2F;&#123;host&#125;&#x2F;wec-counselor-collector-apps&#x2F;stu&#x2F;collector&#x2F;previewAttachment&#39;.format(</span><br><span class="line">        host&#x3D;host)</span><br><span class="line">    data &#x3D; &#123;</span><br><span class="line">        &#39;ossKey&#39;: fileName</span><br><span class="line">    &#125;</span><br><span class="line">    res &#x3D; session.post(url&#x3D;url, headers&#x3D;&#123;</span><br><span class="line">                       &#39;content-type&#39;: &#39;application&#x2F;json&#39;&#125;, data&#x3D;json.dumps(data), verify&#x3D;not debug)</span><br><span class="line">    photoUrl &#x3D; res.json().get(&#39;datas&#39;)</span><br><span class="line">    return photoUrl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#提交表单</span><br><span class="line">def submitForm(formWid, address, collectWid, schoolTaskWid, form, session, host):</span><br><span class="line">    headers &#x3D; &#123;</span><br><span class="line">        &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Linux; Android 4.4.4; OPPO R11 Plus Build&#x2F;KTU84P) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Version&#x2F;4.0 Chrome&#x2F;33.0.0.0 Safari&#x2F;537.36 okhttp&#x2F;3.12.4&#39;,</span><br><span class="line">        &#39;CpdailyStandAlone&#39;: &#39;0&#39;,</span><br><span class="line">        &#39;extension&#39;: &#39;1&#39;,</span><br><span class="line">        &#39;Cpdaily-Extension&#39;: &#39;eZbW2qLZT0G0VbYqnj5mz5UCyZiuS+Mht0ro4VCSTgTancCpi4ru3IpfZibLN2Q4JR3dl7wYTXnTi5dzfAwbYcs5FB4VPqOTrcYNVjoRY9h9J7sxA1MWIWZxiEC7iuzXwAeEjrGmnHnX3P7mprZW66fbhNsIrM938cVo6aK7fgdQx6vGY7OVJBS+kqwk&#x2F;xE2ipLqV0ro4QNZ9u&#x2F;6G9MUbyd7QghLIM9PIRJTrd6TzoYPFBHqDHIY57dHHUBUC8RzfvreU&#x2F;2o5sY&#x3D;&#39;,</span><br><span class="line">        &#39;Content-Type&#39;: &#39;application&#x2F;json; charset&#x3D;utf-8&#39;,</span><br><span class="line">        # 请注意这个应该和配置文件中的host保持一致</span><br><span class="line">        &#39;Host&#39;: host,</span><br><span class="line">        &#39;Connection&#39;: &#39;Keep-Alive&#39;,</span><br><span class="line">        &#39;Accept-Encoding&#39;: &#39;gzip&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 默认正常的提交参数json</span><br><span class="line">    params &#x3D; &#123;&quot;formWid&quot;: formWid, &quot;address&quot;: address, &quot;collectWid&quot;: collectWid, &quot;schoolTaskWid&quot;: schoolTaskWid,</span><br><span class="line">              &quot;form&quot;: form,&quot;uaIsCpadaily&quot;: True,&quot;latitude&quot;:, &quot;longitude&quot;:&#125;</span><br><span class="line">    # print(params)</span><br><span class="line">    submitForm &#x3D; &#39;https:&#x2F;&#x2F;&#123;host&#125;&#x2F;wec-counselor-collector-apps&#x2F;stu&#x2F;collector&#x2F;submitForm&#39;.format(</span><br><span class="line">        host&#x3D;host)</span><br><span class="line">    r &#x3D; session.post(url&#x3D;submitForm, headers&#x3D;headers,</span><br><span class="line">                     data&#x3D;json.dumps(params), verify&#x3D;not debug)</span><br><span class="line">    msg &#x3D; r.json()[&#39;message&#39;]</span><br><span class="line">    return msg</span><br><span class="line"></span><br><span class="line">title_text &#x3D; &#39;今日校园疫结果通知&#39;</span><br><span class="line"></span><br><span class="line">#发送邮件通知</span><br><span class="line">def sendMessage(send, msg):</span><br><span class="line">    if send !&#x3D; &#39;&#39;:</span><br><span class="line">        log(&#39;正在发送邮件通知。。。&#39;)</span><br><span class="line">        res &#x3D; requests.post(url&#x3D;&#39;http:&#x2F;&#x2F;www.zimo.wiki:8080&#x2F;mail-sender&#x2F;sendMail&#39;,</span><br><span class="line">                            data&#x3D;&#123;&#39;title&#39;: title_text, &#39;content&#39;: getTimeStr() + str(msg), &#39;to&#39;: send&#125;)</span><br><span class="line"></span><br><span class="line">        code &#x3D; res.json()[&#39;code&#39;]</span><br><span class="line">        if code &#x3D;&#x3D; 0:</span><br><span class="line">            log(&#39;发送邮件通知成功。。。&#39;)</span><br><span class="line">        else:</span><br><span class="line">            log(&#39;发送邮件通知失败。。。&#39;)</span><br><span class="line">            log(res.json())</span><br><span class="line"></span><br><span class="line">def sendEmail(send,msg):</span><br><span class="line">    my_sender&#x3D; config[&#39;Info&#39;][&#39;Email&#39;][&#39;account&#39;]   # 发件人邮箱账号</span><br><span class="line">    my_pass &#x3D; config[&#39;Info&#39;][&#39;Email&#39;][&#39;password&#39;]         # 发件人邮箱密码</span><br><span class="line">    my_user &#x3D; send      # 收件人邮箱账号，我这边发送给自己</span><br><span class="line">    try:</span><br><span class="line">        msg&#x3D;MIMEText(getTimeStr() + str(msg),&#39;plain&#39;,&#39;utf-8&#39;)</span><br><span class="line">        msg[&#39;From&#39;]&#x3D;formataddr([&quot;FromRunoob&quot;,my_sender])  # 括号里的对应发件人邮箱昵称、发件人邮箱账号</span><br><span class="line">        msg[&#39;To&#39;]&#x3D;formataddr([&quot;FK&quot;,my_user])              # 括号里的对应收件人邮箱昵称、收件人邮箱账号</span><br><span class="line">        msg[&#39;Subject&#39;]&#x3D;title_text               # 邮件的主题，也可以说是标题</span><br><span class="line"></span><br><span class="line">        server&#x3D;smtplib.SMTP_SSL(config[&#39;Info&#39;][&#39;Email&#39;][&#39;server&#39;], config[&#39;Info&#39;][&#39;Email&#39;][&#39;port&#39;])  # 发件人邮箱中的SMTP服务器，端口是25</span><br><span class="line">        server.login(my_sender, my_pass)  # 括号中对应的是发件人邮箱账号、邮箱密码</span><br><span class="line">        server.sendmail(my_sender,[my_user,],msg.as_string())  # 括号中对应的是发件人邮箱账号、收件人邮箱账号、发送邮件</span><br><span class="line">        server.quit()  # 关闭连接</span><br><span class="line">    except Exception:  # 如果 try 中的语句没有执行，则会执行下面的 ret&#x3D;False</span><br><span class="line">        log(&quot;邮件发送失败&quot;)</span><br><span class="line">    else: print(&quot;邮件发送成功&quot;)</span><br><span class="line"></span><br><span class="line">#server酱通知</span><br><span class="line">def sendServerChan(msg):</span><br><span class="line">    log(&#39;正在发送Server酱。。。&#39;)</span><br><span class="line">    res &#x3D; requests.post(url&#x3D;&#39;https:&#x2F;&#x2F;sc.ftqq.com&#x2F;&#123;0&#125;.send&#39;.format(config[&#39;Info&#39;][&#39;ServerChan&#39;]),</span><br><span class="line">                            data&#x3D;&#123;&#39;text&#39;: title_text, &#39;desp&#39;: getTimeStr() + &quot;\n&quot; + str(msg)&#125;)</span><br><span class="line">    code &#x3D; res.json()[&#39;errmsg&#39;]</span><br><span class="line">    if code &#x3D;&#x3D; &#39;success&#39;:</span><br><span class="line">        log(&#39;发送Server酱通知成功。。。&#39;)</span><br><span class="line">    else:</span><br><span class="line">        log(&#39;发送Server酱通知失败。。。&#39;)</span><br><span class="line">        log(&#39;Server酱返回结果&#39;+code)</span><br><span class="line"></span><br><span class="line">#Qmsg酱通知</span><br><span class="line">def sendQmsgChan(msg):</span><br><span class="line">    log(&#39;正在发送Qmsg酱。。。&#39;)</span><br><span class="line">    res &#x3D; requests.post(url&#x3D;&#39;https:&#x2F;&#x2F;qmsg.zendee.cn:443&#x2F;send&#x2F;&#123;0&#125;&#39;.format(config[&#39;Info&#39;][&#39;Qsmg&#39;]),</span><br><span class="line">                            data&#x3D;&#123;&#39;msg&#39;: title_text + &#39;\n时间：&#39; + getTimeStr() + &quot;\n 返回结果：&quot; + str(msg)&#125;)</span><br><span class="line">    code &#x3D; res.json()[&#39;success&#39;]</span><br><span class="line">    if code:</span><br><span class="line">        log(&#39;发送Qmsg酱通知成功。。。&#39;)</span><br><span class="line">    else:</span><br><span class="line">        log(&#39;发送Qmsg酱通知失败。。。&#39;)</span><br><span class="line">        log(&#39;Qmsg酱返回结果&#39;+code)</span><br><span class="line"></span><br><span class="line">#综合提交</span><br><span class="line">def InfoSubmit(msg, send&#x3D;None):</span><br><span class="line">    if(None !&#x3D; send):</span><br><span class="line">        if(config[&#39;Info&#39;][&#39;Email&#39;][&#39;enable&#39;]): sendEmail(send,msg)</span><br><span class="line">        else: sendMessage(send, msg)</span><br><span class="line">    if(config[&#39;Info&#39;][&#39;ServerChan&#39;]): sendServerChan(msg)</span><br><span class="line">    if(config[&#39;Info&#39;][&#39;Qsmg&#39;]): sendQmsgChan(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main_handler(event, context):</span><br><span class="line">    try:</span><br><span class="line">        for user in config[&#39;users&#39;]:</span><br><span class="line">            log(&#39;当前用户：&#39; + str(user[&#39;user&#39;][&#39;username&#39;]))</span><br><span class="line">            apis &#x3D; getCpdailyApis(user)</span><br><span class="line">            log(&#39;脚本开始执行。。。&#39;)</span><br><span class="line">            log(&#39;开始模拟登陆。。。&#39;)</span><br><span class="line">            session &#x3D; getSession(user, apis[&#39;login-url&#39;])</span><br><span class="line">            if session !&#x3D; None:</span><br><span class="line">                log(&#39;模拟登陆成功。。。&#39;)</span><br><span class="line">                log(&#39;正在查询最新待填写问卷。。。&#39;)</span><br><span class="line">                params &#x3D; queryForm(session, apis)</span><br><span class="line">                if str(params) &#x3D;&#x3D; &#39;None&#39;:</span><br><span class="line">                    log(&#39;获取最新待填写问卷失败，可能是辅导员还没有发布。。。&#39;)</span><br><span class="line">                    InfoSubmit(&#39;没有新问卷&#39;)</span><br><span class="line">                    exit(-1)</span><br><span class="line">                log(&#39;查询最新待填写问卷成功。。。&#39;)</span><br><span class="line">                log(&#39;正在自动填写问卷。。。&#39;)</span><br><span class="line">                form &#x3D; fillForm(session, params[&#39;form&#39;], apis[&#39;host&#39;])</span><br><span class="line">                log(&#39;填写问卷成功。。。&#39;)</span><br><span class="line">                log(&#39;正在自动提交。。。&#39;)</span><br><span class="line">                msg &#x3D; submitForm(params[&#39;formWid&#39;], user[&#39;user&#39;][&#39;address&#39;], params[&#39;collectWid&#39;],</span><br><span class="line">                                 params[&#39;schoolTaskWid&#39;], form, session, apis[&#39;host&#39;])</span><br><span class="line">                if msg &#x3D;&#x3D; &#39;SUCCESS&#39;:</span><br><span class="line">                    log(&#39;自动提交成功！&#39;)</span><br><span class="line">                    InfoSubmit(&#39;自动提交成功！&#39;, user[&#39;user&#39;][&#39;email&#39;])</span><br><span class="line">                elif msg &#x3D;&#x3D; &#39;该收集已填写无需再次填写&#39;:</span><br><span class="line">                    log(&#39;今日已提交！&#39;)</span><br><span class="line">                    # InfoSubmit(&#39;今日已提交！&#39;, user[&#39;user&#39;][&#39;email&#39;])</span><br><span class="line">                    InfoSubmit(&#39;今日已提交！&#39;)</span><br><span class="line">                else:</span><br><span class="line">                    log(&#39;自动提交失败。。。&#39;)</span><br><span class="line">                    log(&#39;错误是&#39; + msg)</span><br><span class="line">                    InfoSubmit(&#39;自动提交失败！错误是&#39; + msg, user[&#39;user&#39;][&#39;email&#39;])</span><br><span class="line">                    exit(-1)</span><br><span class="line">            else:</span><br><span class="line">                log(&#39;模拟登陆失败。。。&#39;)</span><br><span class="line">                log(&#39;原因可能是学号或密码错误，请检查配置后，重启脚本。。。&#39;)</span><br><span class="line">                exit(-1)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        InfoSubmit(&quot;出现问题了！&quot;+str(e))</span><br><span class="line">        raise e</span><br><span class="line">    else:</span><br><span class="line">        return &#39;success&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#配合Windows计划任务等使用</span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    print(main_handler(&#123;&#125;, &#123;&#125;))</span><br><span class="line">    # for user in config[&#39;users&#39;]:</span><br><span class="line">    #     log(getCpdailyApis(user))</span><br></pre></td></tr></table></figure>
<h2 id="2-config-yml"><a href="#2-config-yml" class="headerlink" title="2.config.yml:"></a>2.config.yml:</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#登陆相关配置</span><br><span class="line">login:</span><br><span class="line">  #开放的模拟登陆api服务器地址</span><br><span class="line">  api: &quot;http:&#x2F;&#x2F;49.235.105.52:8080&#x2F;wisedu-unified-login-api-v1.0&#x2F;api&#x2F;login&quot;</span><br><span class="line">#用户组配置</span><br><span class="line">users:</span><br><span class="line">  #单个用户配置</span><br><span class="line">  - user:</span><br><span class="line">      #username 学号或者工号</span><br><span class="line">      username: &#39;&#39;</span><br><span class="line">      #password 密码</span><br><span class="line">      password: &#39;&#39;</span><br><span class="line">      #address 地址，定位信息</span><br><span class="line">      address: </span><br><span class="line">      #email 接受通知消息的邮箱</span><br><span class="line">      email: </span><br><span class="line">      #lon 当前位置经度，可以访问http:&#x2F;&#x2F;zuobiao.ay800.com&#x2F;s&#x2F;27&#x2F;index.php获取</span><br><span class="line">      longitude: &quot;&quot;</span><br><span class="line">      #lat 当前位置纬度</span><br><span class="line">      latitude: &quot;&quot;</span><br><span class="line">      #school 学校全称</span><br><span class="line">      school: </span><br><span class="line">#今日校园相关配置</span><br><span class="line">cpdaily:</span><br><span class="line">  #表单组默认选项配置</span><br><span class="line">  defaults:</span><br><span class="line">    #表单默认选项配置，按顺序，注意，只有标必填项的才处理，不会配置就执行generate.py</span><br><span class="line">    - default:</span><br><span class="line">        title: 今天你的所在地是？</span><br><span class="line">        type: 1</span><br><span class="line">        value: xxx&#x2F;xxx&#x2F;xxx</span><br><span class="line">    - default:</span><br><span class="line">        title: 今天你的体温是多少？</span><br><span class="line">        type: 2</span><br><span class="line">        value: 37.2℃及以下</span><br><span class="line">    - default:</span><br><span class="line">        title: 今天你的身体状况是？</span><br><span class="line">        type: 2</span><br><span class="line">        value: 健康</span><br><span class="line">    - default:</span><br><span class="line">        title: 近14天你或你的共同居住人是否有疫情中、高风险区域人员接触史？</span><br><span class="line">        type: 2</span><br><span class="line">        value: 否</span><br><span class="line">    - default:</span><br><span class="line">        title: 近14天你或你的共同居住人是否和确诊、疑似病人接触过？</span><br><span class="line">        type: 2</span><br><span class="line">        value: 否</span><br><span class="line">    - default:</span><br><span class="line">        title: 近14天你或你的共同居住人是否是确诊、疑似病例？</span><br><span class="line">        type: 2</span><br><span class="line">        value: 否</span><br><span class="line">    - default:</span><br><span class="line">        title: 你或你的共同居住人目前是否被医学隔离？</span><br><span class="line">        type: 2</span><br><span class="line">        value: 否</span><br><span class="line">    - default:</span><br><span class="line">        title: 今天你当地的健康码颜色是？</span><br><span class="line">        type: 2</span><br><span class="line">        value: 绿色</span><br><span class="line">    - default:</span><br><span class="line">        title: 本人是否承诺以上所填报的全部内容均属实、准确，不存在任何隐瞒与不实的情况，更无遗漏之处</span><br><span class="line">        type: 2</span><br><span class="line">        value: 是</span><br><span class="line"></span><br><span class="line">Info:</span><br><span class="line">  ServerChan: # 填写Server酱的SCKEY</span><br><span class="line">  Qsmg:  #填写qsmg酱的SCKEY</span><br><span class="line">  Email:</span><br><span class="line">    enable: true</span><br><span class="line">    server: smtp.qq.com # 填写邮件的smtp服务器</span><br><span class="line">    port: 465 # 填写邮件服务器的端口号</span><br><span class="line">    account: &#39;&#39; # 邮件服务器登录用户名</span><br><span class="line">    password: &#39;&#39; # 邮件服务器登录密码&#96;</span><br></pre></td></tr></table></figure>
<h2 id="3-generate-py"><a href="#3-generate-py" class="headerlink" title="3.generate.py:"></a>3.generate.py:</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import index as app</span><br><span class="line">import yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 生成默认配置</span><br><span class="line">def generate():</span><br><span class="line">    config &#x3D; app.config</span><br><span class="line">    user &#x3D; config[&#39;users&#39;][0]</span><br><span class="line">    apis &#x3D; app.getCpdailyApis(user)</span><br><span class="line">    session &#x3D; app.getSession(user, apis[&#39;login-url&#39;])</span><br><span class="line">    form &#x3D; dict(app.queryForm(session, apis))[&#39;form&#39;]</span><br><span class="line">    # app.log(form)</span><br><span class="line">    defaults &#x3D; []</span><br><span class="line">    sort &#x3D; 1</span><br><span class="line">    for formItem in form:</span><br><span class="line">        if formItem[&#39;isRequired&#39;] &#x3D;&#x3D; 1:</span><br><span class="line">            default &#x3D; &#123;&#125;</span><br><span class="line">            one &#x3D; &#123;&#125;</span><br><span class="line">            default[&#39;title&#39;] &#x3D; formItem[&#39;title&#39;]</span><br><span class="line">            default[&#39;type&#39;] &#x3D; formItem[&#39;fieldType&#39;]</span><br><span class="line">            print(&#39;问题%d：&#39; % sort + default[&#39;title&#39;])</span><br><span class="line">            if default[&#39;type&#39;] &#x3D;&#x3D; 1 or default[&#39;type&#39;] &#x3D;&#x3D; 5:</span><br><span class="line">                default[&#39;value&#39;] &#x3D; input(&quot;请输入文本：&quot;)</span><br><span class="line">            if default[&#39;type&#39;] &#x3D;&#x3D; 2:</span><br><span class="line">                fieldItems &#x3D; formItem[&#39;fieldItems&#39;]</span><br><span class="line">                num &#x3D; 1</span><br><span class="line">                for fieldItem in fieldItems:</span><br><span class="line">                    print(&#39;\t%d &#39; % num + fieldItem[&#39;content&#39;])</span><br><span class="line">                    num +&#x3D; 1</span><br><span class="line">                choose &#x3D; int(input(&quot;请输入序号：&quot;))</span><br><span class="line">                if choose &lt; 1 or choose &gt; num:</span><br><span class="line">                    print(&#39;输入错误，请重新执行此脚本&#39;)</span><br><span class="line">                    exit(-1)</span><br><span class="line">                default[&#39;value&#39;] &#x3D; fieldItems[choose - 1][&#39;content&#39;]</span><br><span class="line">            if default[&#39;type&#39;] &#x3D;&#x3D; 3:</span><br><span class="line">                fieldItems &#x3D; formItem[&#39;fieldItems&#39;]</span><br><span class="line">                num &#x3D; 1</span><br><span class="line">                for fieldItem in fieldItems:</span><br><span class="line">                    print(&#39;\t%d &#39; % num + fieldItem[&#39;content&#39;])</span><br><span class="line">                    num +&#x3D; 1</span><br><span class="line">                chooses &#x3D; list(map(int, input(&#39;请输入序号（可输入多个，请用空格隔开）：&#39;).split()))</span><br><span class="line">                default[&#39;value&#39;] &#x3D; &#39;&#39;</span><br><span class="line">                for i in range(0, len(chooses)):</span><br><span class="line">                    choose &#x3D; chooses[i]</span><br><span class="line">                    if choose &lt; 1 or choose &gt; num:</span><br><span class="line">                        print(&#39;输入错误，请重新执行此脚本&#39;)</span><br><span class="line">                        exit(-1)</span><br><span class="line">                    if i !&#x3D; len(chooses) - 1:</span><br><span class="line">                        default[&#39;value&#39;] +&#x3D; fieldItems[choose - 1][&#39;content&#39;] + &#39;,&#39;</span><br><span class="line">                    else:</span><br><span class="line">                        default[&#39;value&#39;] +&#x3D; fieldItems[choose - 1][&#39;content&#39;]</span><br><span class="line">            if default[&#39;type&#39;] &#x3D;&#x3D; 4:</span><br><span class="line">                default[&#39;value&#39;] &#x3D; input(&quot;请输入图片名称：&quot;)</span><br><span class="line">            one[&#39;default&#39;] &#x3D; default</span><br><span class="line">            defaults.append(one)</span><br><span class="line">            sort +&#x3D; 1</span><br><span class="line">    print(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;分隔线&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)</span><br><span class="line">    print(yaml.dump(defaults, allow_unicode&#x3D;True))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    generate()</span><br></pre></td></tr></table></figure>
<h1 id="层依赖下载：dependency-zip密码-gory"><a href="#层依赖下载：dependency-zip密码-gory" class="headerlink" title="层依赖下载：dependency.zip密码:gory"></a>层依赖下载：<a target="_blank" rel="noopener" href="https://wws.lanzous.com/i9UYUm3pted">dependency.zip</a>密码:gory</h1><h1 id="三-注意："><a href="#三-注意：" class="headerlink" title="三,注意："></a>三,注意：</h1><h2 id="1-config-yml是添加今日校园的账户信息、邮箱、address、经纬度以及第一个问题的所在地。"><a href="#1-config-yml是添加今日校园的账户信息、邮箱、address、经纬度以及第一个问题的所在地。" class="headerlink" title="1.config.yml是添加今日校园的账户信息、邮箱、address、经纬度以及第一个问题的所在地。"></a>1.config.yml是添加今日校园的账户信息、邮箱、address、经纬度以及第一个问题的所在地。</h2><h2 id="2-在index-py中第264行左右中（”latitude”-“longitude”-）这两个需要填写，这俩数是经纬度，经纬度的查询在这里：（经纬度）。"><a href="#2-在index-py中第264行左右中（”latitude”-“longitude”-）这两个需要填写，这俩数是经纬度，经纬度的查询在这里：（经纬度）。" class="headerlink" title="2.在index.py中第264行左右中（”latitude”:, “longitude”:）这两个需要填写，这俩数是经纬度，经纬度的查询在这里：（经纬度）。"></a>2.在index.py中第264行左右中（”latitude”:, “longitude”:）这两个需要填写，这俩数是经纬度，经纬度的查询在这里：（<a target="_blank" rel="noopener" href="https://lbs.qq.com/tool/getpoint/index.html">经纬度</a>）。</h2><h2 id="3-我的API可能会失效，建议使用子墨的api-但子墨的api人用的多，可能会超时，所以有服务器的可以自建api，具体教程请去子墨的博客。子墨的API。"><a href="#3-我的API可能会失效，建议使用子墨的api-但子墨的api人用的多，可能会超时，所以有服务器的可以自建api，具体教程请去子墨的博客。子墨的API。" class="headerlink" title="3.我的API可能会失效，建议使用子墨的api,但子墨的api人用的多，可能会超时，所以有服务器的可以自建api，具体教程请去子墨的博客。子墨的API。"></a>3.我的API可能会失效，建议使用子墨的api,但子墨的api人用的多，可能会超时，所以有服务器的可以自建api，具体教程请去子墨的博客。子墨的<a target="_blank" rel="noopener" href="http://www.zimo.wiki:8080/wisedu-unified-login-api-v1.0/api/login">API</a>。</h2><h2 id="4-qmsg酱key填写到config-yml中，qmsg酱这是网站。"><a href="#4-qmsg酱key填写到config-yml中，qmsg酱这是网站。" class="headerlink" title="4.qmsg酱key填写到config.yml中，qmsg酱这是网站。"></a>4.qmsg酱key填写到config.yml中，<a target="_blank" rel="noopener" href="https://qmsg.zendee.cn/index.html">qmsg酱</a>这是网站。</h2><h3 id="注：sever酱不能用了"><a href="#注：sever酱不能用了" class="headerlink" title="注：sever酱不能用了"></a>注：sever酱不能用了</h3><h2 id="5-generate-py是配置config-yml里问题的文件，当然你也可以使用抓包获取"><a href="#5-generate-py是配置config-yml里问题的文件，当然你也可以使用抓包获取" class="headerlink" title="5.generate.py是配置config.yml里问题的文件，当然你也可以使用抓包获取"></a>5.generate.py是配置config.yml里问题的文件，当然你也可以使用抓包获取</h2></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%89%93%E5%8D%A1/">打卡</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/21/fwW5sN9B8J1UdPZ.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2021/02/24/zhuyi/"><img class="prev-cover" src="https://i.loli.net/2021/02/21/ENSkwsFn84Au197.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">今日校园部署到腾讯云函数</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/02/24/zhuyi/" title="今日校园部署到腾讯云函数"><img class="cover" src="https://i.loli.net/2021/02/21/ENSkwsFn84Au197.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-24</div><div class="title">今日校园部署到腾讯云函数</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E9%A6%96%E5%85%88"><span class="toc-number">1.</span> <span class="toc-text">一,首先</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%8B%E6%96%B9%E9%93%BE%E6%8E%A5%E6%98%AF%E7%9C%8B%E4%BD%A0%E7%9A%84%E5%AD%A6%E6%A0%A1%E4%BA%91%E7%AB%AF%E8%83%BD%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8"><span class="toc-number">1.0.1.</span> <span class="toc-text">1.下方链接是看你的学校云端能不能使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%EF%BC%9A%E5%A6%82%E6%9E%9C%E4%B8%8D%E8%83%BD%E8%AF%B7%E5%8E%BB%E5%AD%90%E5%A2%A8%E7%9A%84%E5%8D%9A%E5%AE%A2%E8%A7%A3%E5%86%B3"><span class="toc-number">1.0.2.</span> <span class="toc-text">注：如果不能请去子墨的博客解决</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%95%99%E5%8A%A1%E7%BD%91%E7%AB%99%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%9C%B0%E6%96%B9%E6%9F%A5%E6%89%BE%E8%87%AA%E5%B7%B1%E5%AD%A6%E6%A0%A1%E7%9A%84%E6%95%99%E5%8A%A1%E7%BD%91%E7%AB%99"><span class="toc-number">1.0.3.</span> <span class="toc-text">2.教务网站在这个地方查找自己学校的教务网站:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%EF%BC%8C%E4%BB%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">二，代码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-index-py"><span class="toc-number">2.1.</span> <span class="toc-text">1.index.py:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-config-yml"><span class="toc-number">2.2.</span> <span class="toc-text">2.config.yml:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-generate-py"><span class="toc-number">2.3.</span> <span class="toc-text">3.generate.py:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B1%82%E4%BE%9D%E8%B5%96%E4%B8%8B%E8%BD%BD%EF%BC%9Adependency-zip%E5%AF%86%E7%A0%81-gory"><span class="toc-number">3.</span> <span class="toc-text">层依赖下载：dependency.zip密码:gory</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-%E6%B3%A8%E6%84%8F%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">三,注意：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-config-yml%E6%98%AF%E6%B7%BB%E5%8A%A0%E4%BB%8A%E6%97%A5%E6%A0%A1%E5%9B%AD%E7%9A%84%E8%B4%A6%E6%88%B7%E4%BF%A1%E6%81%AF%E3%80%81%E9%82%AE%E7%AE%B1%E3%80%81address%E3%80%81%E7%BB%8F%E7%BA%AC%E5%BA%A6%E4%BB%A5%E5%8F%8A%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9A%84%E6%89%80%E5%9C%A8%E5%9C%B0%E3%80%82"><span class="toc-number">4.1.</span> <span class="toc-text">1.config.yml是添加今日校园的账户信息、邮箱、address、经纬度以及第一个问题的所在地。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9C%A8index-py%E4%B8%AD%E7%AC%AC264%E8%A1%8C%E5%B7%A6%E5%8F%B3%E4%B8%AD%EF%BC%88%E2%80%9Dlatitude%E2%80%9D-%E2%80%9Clongitude%E2%80%9D-%EF%BC%89%E8%BF%99%E4%B8%A4%E4%B8%AA%E9%9C%80%E8%A6%81%E5%A1%AB%E5%86%99%EF%BC%8C%E8%BF%99%E4%BF%A9%E6%95%B0%E6%98%AF%E7%BB%8F%E7%BA%AC%E5%BA%A6%EF%BC%8C%E7%BB%8F%E7%BA%AC%E5%BA%A6%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%9C%A8%E8%BF%99%E9%87%8C%EF%BC%9A%EF%BC%88%E7%BB%8F%E7%BA%AC%E5%BA%A6%EF%BC%89%E3%80%82"><span class="toc-number">4.2.</span> <span class="toc-text">2.在index.py中第264行左右中（”latitude”:, “longitude”:）这两个需要填写，这俩数是经纬度，经纬度的查询在这里：（经纬度）。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%88%91%E7%9A%84API%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%A4%B1%E6%95%88%EF%BC%8C%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8%E5%AD%90%E5%A2%A8%E7%9A%84api-%E4%BD%86%E5%AD%90%E5%A2%A8%E7%9A%84api%E4%BA%BA%E7%94%A8%E7%9A%84%E5%A4%9A%EF%BC%8C%E5%8F%AF%E8%83%BD%E4%BC%9A%E8%B6%85%E6%97%B6%EF%BC%8C%E6%89%80%E4%BB%A5%E6%9C%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%BB%BAapi%EF%BC%8C%E5%85%B7%E4%BD%93%E6%95%99%E7%A8%8B%E8%AF%B7%E5%8E%BB%E5%AD%90%E5%A2%A8%E7%9A%84%E5%8D%9A%E5%AE%A2%E3%80%82%E5%AD%90%E5%A2%A8%E7%9A%84API%E3%80%82"><span class="toc-number">4.3.</span> <span class="toc-text">3.我的API可能会失效，建议使用子墨的api,但子墨的api人用的多，可能会超时，所以有服务器的可以自建api，具体教程请去子墨的博客。子墨的API。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-qmsg%E9%85%B1key%E5%A1%AB%E5%86%99%E5%88%B0config-yml%E4%B8%AD%EF%BC%8Cqmsg%E9%85%B1%E8%BF%99%E6%98%AF%E7%BD%91%E7%AB%99%E3%80%82"><span class="toc-number">4.4.</span> <span class="toc-text">4.qmsg酱key填写到config.yml中，qmsg酱这是网站。</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%EF%BC%9Asever%E9%85%B1%E4%B8%8D%E8%83%BD%E7%94%A8%E4%BA%86"><span class="toc-number">4.4.1.</span> <span class="toc-text">注：sever酱不能用了</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-generate-py%E6%98%AF%E9%85%8D%E7%BD%AEconfig-yml%E9%87%8C%E9%97%AE%E9%A2%98%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8C%E5%BD%93%E7%84%B6%E4%BD%A0%E4%B9%9F%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E6%8A%93%E5%8C%85%E8%8E%B7%E5%8F%96"><span class="toc-number">4.5.</span> <span class="toc-text">5.generate.py是配置config.yml里问题的文件，当然你也可以使用抓包获取</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.loli.net/2021/02/21/fwW5sN9B8J1UdPZ.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 陌路人</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'oUQvvbWLHqNdnIgt4dDGKRKb-gzGzoHsz',
      appKey: 'xblRJWnMk6VOcHUB2LsoB27W',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'http://example.com/2021/02/20/file_name/'
    this.page.identifier = '2021/02/20/file_name/'
    this.page.title = '今日校园信息收集自动提交'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><div class="aplayer no-destroy" data-id="6627414700" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script type="text/javascript" src="/js/fairyDustCursor.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>window.$crisp = [];
window.CRISP_WEBSITE_ID = "6927b82e-2032-425b-bdf1-cd66dedb5bf4";
(function () {
  d = document;
  s = d.createElement("script");
  s.src = "https://client.crisp.chat/l.js";
  s.async = 1;
  d.getElementsByTagName("head")[0].appendChild(s);
})();
$crisp.push(["safe", true])

if (true) {
  $crisp.push(["do", "chat:hide"])
  $crisp.push(["on", "chat:closed", function() {
    $crisp.push(["do", "chat:hide"])
  }])
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      $crisp.push(["do", "chat:show"])
      $crisp.push(["do", "chat:open"])

    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      $crisp.push(["do", "chat:hide"])
    }
    function chatBtnShow () {
      $crisp.push(["do", "chat:show"])
    }
  }
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>